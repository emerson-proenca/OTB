{% extends "base.html" %} {% block title %}OTB - register {% endblock %} {%
block meta_description %}Register for OTB (Over The Board).{% endblock %} {%
block content %}

<div class="container container-tight py-4">
  <form
    class="card card-md"
    method="post"
    action="/register"
    autocomplete="off"
    novalidate=""
  >
    <div class="card-body">
      <h2 class="card-title text-center mb-4 fs-1">Create new account</h2>
      <div class="mb-3">
        <label class="form-label required">Name</label>
        <input
          type="text"
          name="username"
          class="form-control"
          placeholder="Enter name"
          autocomplete="on"
        />
      </div>
      <div class="mb-3">
        <label class="form-label required">Email address</label>
        <input
          type="email"
          name="email"
          class="form-control"
          placeholder="Enter email"
          autocomplete="on"
        />
      </div>
      <div class="mb-3">
        <label class="form-label required">Password</label>
        <div class="input-group input-group-flat">
          <input
            type="password"
            class="form-control"
            name="password"
            placeholder="Password"
            autocomplete="off"
          />
          <span class="input-group-text">
            <a
              href="#"
              class="link-secondary"
              data-bs-toggle="tooltip"
              aria-label="Show password"
              data-bs-original-title="Show password"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon icon-1"
              >
                <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"></path>
                <path
                  d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6"
                ></path>
              </svg>
            </a>
          </span>
        </div>
      </div>
      <div class="mb-3"></div>
      <div class="form-footer">
        <button type="submit" class="btn btn-primary w-100">
          Create new account
        </button>
      </div>
    </div>
  </form>
  <div class="text-center text-secondary mt-3">
    Already have account? <a href="./login" tabindex="-1">Login</a>
  </div>
</div>

{% if message %}
<p style="color: green">{{ message }}</p>
{% endif %}

<script>
  const form = document.getElementById("register-form");
  const msg = document.getElementById("message");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = {
      username: document.getElementById("username").value,
      email: document.getElementById("email").value,
      password: document.getElementById("password").value,
    };

    msg.textContent = "Criando conta...";

    try {
      const res = await fetch("/api/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      if (res.status === 204) {
        msg.textContent = "Conta criada com sucesso!";
        form.reset();
      } else {
        const error = await res.json();
        msg.textContent =
          "Erro: " + (error.detail || "Não foi possível criar a conta.");
      }
    } catch (err) {
      msg.textContent = "Erro de conexão com o servidor.";
    }
  });
</script>

{% endblock %}
