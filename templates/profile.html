{% extends "base.html" %} {% block title %}OTB - homepage {% endblock %} {%
block meta_description %}Homepage of OTB (Over The Board).{% endblock %} {%
block content %}

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
  /* ---------------------------------------------------- */
  /* NOVOS ESTILOS - INSPIRAÇÃO GITHUB DARK MODE */
  /* ---------------------------------------------------- */

  /* Cores base do tema escuro do GitHub */
  :root {
    --gh-bg-primary: #0d1117; /* Fundo principal */
    --gh-bg-secondary: #161b22; /* Fundo de Cards/Containers */
    --gh-text-primary: #c9d1d9; /* Texto principal claro */
    --gh-text-secondary: #8b949e; /* Texto secundário/sutil */
    --gh-border-color: #30363d; /* Cor da borda */
    --gh-green: #3fb950; /* Verde de sucesso/ativo */
    --gh-blue: #58a6ff; /* Azul para links/botões primários */
  }

  /* Aplica o tema escuro ao corpo da página (se a base.html não fizer) */
  body {
    background-color: var(--gh-bg-primary);
    color: var(--gh-text-primary);
  }

  /* Ajusta a largura e padding do container principal */
  .container {
    max-width: 1280px; /* Largura máxima comum em layouts grandes */
  }

  /* Estilo dos cards (Containers) */
  .card {
    background-color: var(--gh-bg-secondary);
    border: 1px solid var(--gh-border-color);
    border-radius: 6px;
    color: var(--gh-text-primary);
  }

  /* Estilos específicos do Perfil/Sidebar */
  .profile-avatar {
    aspect-ratio: 1 / 1;
    width: 260px;
    height: 260px;
    border-radius: 50%;
    object-fit: cover;
    object-position: center;
    border: 2px solid var(--gh-border-color); /* Borda sutil */
  }

  .profile-sidebar {
    box-shadow: none !important;
    padding: 0 !important;
    background-color: transparent;
    border: none;
    top: 64px;
  }

  /* Estilo do Nome de usuário e handle */
  .profile-sidebar h3 {
    font-size: 26px;
    line-height: 1.25;
    margin-bottom: 0px;
  }

  .profile-sidebar .text {
    color: var(--gh-text-secondary);
    font-size: 20px;
    margin-top: 0;
    line-height: 1.25;
  }

  /* Estilo da Bio */
  .bio {
    white-space: pre-wrap;
    margin-top: 16px !important;
    font-size: 16px;
    line-height: 1.5;
  }

  /* Estilo do Botão */
  .btn-outline-primary {
    color: var(--gh-text-primary);
    background-color: var(--gh-bg-secondary);
    border-color: var(--gh-border-color);
  }

  .btn-outline-primary:hover {
    color: var(--gh-text-primary);
    background-color: #30363d;
    border-color: var(--gh-border-color);
  }

  /* Separador */
  hr {
    border-color: var(--gh-border-color);
    margin: 16px 0;
  }

  /* Textos de detalhes */
  .profile-sidebar p.mb-1,
  .profile-sidebar p.mb-0 {
    font-size: 14px;
    color: var(--gh-text-primary);
    text-align: left;
    padding: 2px 0;
  }

  .profile-sidebar strong {
    font-weight: 600;
  }

  /* Badge para status (simulando cores do GitHub) */
  .badge.bg-success {
    background-color: var(--gh-green) !important;
    color: var(--gh-bg-primary) !important;
  }

  .badge.bg-danger {
    background-color: #f85149 !important;
    color: var(--gh-bg-primary) !important;
  }

  /* Card de Torneios Recentes */
  .border-bottom {
    border-color: var(--gh-border-color) !important;
  }

  .text-muted {
    color: var(--gh-text-secondary) !important;
  }

  /* ---------------------------------------------------- */
  /* ESTILOS ORIGINAIS (Mantenho apenas os essenciais) */
  /* ---------------------------------------------------- */

  .profile-sidebar {
    position: sticky;
  }

  /* Garante que o canvas seja flexível no container */
  #ratingChart {
    max-width: 100%;
    height: auto;
  }
</style>

<div class="container py-5">
  <div class="row">
    <div class="col-md-4 col-lg-3 mb-4">
      <div class="profile-sidebar px-3">
        <img
          src="{{ user.profile_picture or '/static/avatar.jpg' }}"
          alt="Avatar"
          class="profile-avatar mb-3"
        />
        <div class="mb-3">
          <h3 class="fw-bold">{{ user.name }}</h3>
          <p class="text">{{ user.role }}</p>
        </div>

        <p class="bio mt-3">{{ user.bio or 'Nenhuma bio disponível.' }}</p>

        {% if current_user and current_user.id == user.id %}
        <button class="btn btn-outline-primary w-100 mt-3" id="editProfileBtn">
          Editar Perfil
        </button>
        {% else %}
        <button class="btn btn-outline-primary w-100 mt-3" id="followBtn">
          Seguir
        </button>
        {% endif %}

        <hr />

        <div class="mb-3">
          <p class="mb-1">
            <span class="text-muted me-2"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="icon icon-tabler icons-tabler-filled icon-tabler-map-pin"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path
                  d="M18.364 4.636a9 9 0 0 1 .203 12.519l-.203 .21l-4.243 4.242a3 3 0 0 1 -4.097 .135l-.144 -.135l-4.244 -4.243a9 9 0 0 1 12.728 -12.728zm-6.364 3.364a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z"
                />
              </svg>
            </span>
            {{ user.country }}, {{ user.region }}
          </p>
          <p class="mb-1">
            <span class="text-muted me-2"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="icon icon-tabler icons-tabler-filled icon-tabler-man"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path
                  d="M15 8c1.628 0 3.2 .787 4.707 2.293a1 1 0 0 1 -1.414 1.414c-.848 -.848 -1.662 -1.369 -2.444 -1.587l-.849 5.944v4.936a1 1 0 0 1 -2 0v-4h-2v4a1 1 0 0 1 -2 0v-4.929l-.85 -5.951c-.781 .218 -1.595 .739 -2.443 1.587a1 1 0 1 1 -1.414 -1.414c1.506 -1.506 3.08 -2.293 4.707 -2.293z"
                />
                <path
                  d="M12 1a3 3 0 1 1 -3 3l.005 -.176a3 3 0 0 1 2.995 -2.824"
                />
              </svg>
            </span>
            {{ user.gender or 'Não informado' }}
          </p>
          <p class="mb-0">
            <span class="text-muted me-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="icon icon-tabler icons-tabler-filled icon-tabler-calendar"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path
                  d="M16 2a1 1 0 0 1 .993 .883l.007 .117v1h1a3 3 0 0 1 2.995 2.824l.005 .176v12a3 3 0 0 1 -2.824 2.995l-.176 .005h-12a3 3 0 0 1 -2.995 -2.824l-.005 -.176v-12a3 3 0 0 1 2.824 -2.995l.176 -.005h1v-1a1 1 0 0 1 1.993 -.117l.007 .117v1h6v-1a1 1 0 0 1 1 -1zm3 7h-14v9.625c0 .705 .386 1.286 .883 1.366l.117 .009h12c.513 0 .936 -.53 .993 -1.215l.007 -.16v-9.625z"
                />
                <path
                  d="M12 12a1 1 0 0 1 .993 .883l.007 .117v3a1 1 0 0 1 -1.993 .117l-.007 -.117v-2a1 1 0 0 1 -.117 -1.993l.117 -.007h1z"
                />
              </svg>
            </span>
            {{ user.birthdate or 'Não informado' }}
          </p>
        </div>
      </div>
    </div>

    <div class="col-md-8 col-lg-9">
      <h1 class="fw-bold mb-3">
        Essa secção está em Desenvolvimento. Em Breve!
      </h1>
      <div class="card mb-4 p-4">
        <h2 class="fw-bold mb-3">Evolução do Rating</h2>

        <div style="max-height: 250px">
          <canvas id="ratingChart"></canvas>
        </div>
      </div>

      <div class="card p-4">
        <h2 class="fw-bold mb-3">Torneios Recentes</h2>

        <div id="tournaments">
          <div class="border-bottom py-2">
            <strong>Torneio de Primavera</strong>
            <p class="text-muted mb-0">3º Lugar — Março 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Open de Inverno</strong>
            <p class="text-muted mb-0">2º Lugar — Julho 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Campeonato Nacional</strong>
            <p class="text-muted mb-0">Participante — Outubro 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Torneio de Primavera</strong>
            <p class="text-muted mb-0">3º Lugar — Março 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Open de Inverno</strong>
            <p class="text-muted mb-0">2º Lugar — Julho 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Campeonato Nacional</strong>
            <p class="text-muted mb-0">Participante — Outubro 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Torneio de Primavera</strong>
            <p class="text-muted mb-0">3º Lugar — Março 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Open de Inverno</strong>
            <p class="text-muted mb-0">2º Lugar — Julho 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Campeonato Nacional</strong>
            <p class="text-muted mb-0">Participante — Outubro 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Torneio de Primavera</strong>
            <p class="text-muted mb-0">3º Lugar — Março 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Open de Inverno</strong>
            <p class="text-muted mb-0">2º Lugar — Julho 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Campeonato Nacional</strong>
            <p class="text-muted mb-0">Participante — Outubro 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Torneio de Primavera</strong>
            <p class="text-muted mb-0">3º Lugar — Março 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Open de Inverno</strong>
            <p class="text-muted mb-0">2º Lugar — Julho 2025</p>
          </div>
          <div class="border-bottom py-2">
            <strong>Campeonato Nacional</strong>
            <p class="text-muted mb-0">Participante — Outubro 2025</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div
  id="toast-container"
  class="toast-container position-fixed top-0 end-0 p-3"
></div>

<script>
  // Este bloco de código SÓ funcionará se o Chart.js (via CDN) estiver carregado.
  // Certifique-se de adicionar o CDN na base.html ou no topo deste arquivo!

  // Dados Mockup
  const data = {
    labels: [
      "Jan",
      "Fev",
      "Mar",
      "Abr",
      "Mai",
      "Jun",
      "Jul",
      "Ago",
      "Set",
      "Out",
    ],
    datasets: [
      {
        label: "Rating FIDE",
        data: [1200, 1250, 1230, 1300, 1280, 1350, 1320, 1400, 1380, 1420],
        borderWidth: 2,
        fill: true, // Preenche a área abaixo da linha
        tension: 0.4, // Curvatura da linha
        // Cores ajustadas para o tema escuro do GitHub
        borderColor: "#58a6ff", // Cor da linha (Azul)
        backgroundColor: "rgba(88, 166, 255, 0.1)", // Fundo preenchido levemente azul
        pointBackgroundColor: "#58a6ff",
        pointBorderColor: "#0d1117", // Borda do ponto para destacar no fundo do card
      },
    ],
  };

  // Configuração do Gráfico
  const config = {
    type: "line",
    data: data,
    options: {
      responsive: true,
      maintainAspectRatio: false, // Permite controlar a altura do container pai
      scales: {
        y: {
          beginAtZero: false,
          ticks: {
            stepSize: 50,
            color: "#8b949e", // Cor do texto do eixo Y
          },
          grid: {
            color: "#30363d", // Cor das linhas de grade
            borderColor: "#30363d",
          },
        },
        x: {
          ticks: {
            color: "#8b949e", // Cor do texto do eixo X
          },
          grid: {
            color: "#30363d",
            borderColor: "#30363d",
          },
        },
      },
      plugins: {
        legend: {
          labels: {
            color: "#c9d1d9", // Cor da legenda
          },
        },
      },
    },
  };

  // Renderização do Gráfico
  const ctx = document.getElementById("ratingChart");
  if (ctx) {
    // Ajusta o tamanho do container (div) para o gráfico.
    ctx.parentElement.style.height = "250px";
    const ratingChart = new Chart(ctx, config);
  }

  // Comportamento do Botão de Seguir/Editar (Mantido)
  const followBtn = document.getElementById("followBtn");
  if (followBtn) {
    followBtn.addEventListener("click", () => {
      const following = followBtn.classList.toggle("btn-primary");

      if (following) {
        followBtn.classList.remove("btn-outline-primary");
        followBtn.classList.add("btn-primary");
      } else {
        followBtn.classList.add("btn-outline-primary");
        followBtn.classList.remove("btn-primary");
      }

      followBtn.textContent = following ? "Seguindo" : "Seguir";
    });
  }

  const editBtn = document.getElementById("editProfileBtn");
  if (editBtn) {
    editBtn.addEventListener("click", () => {
      window.location.href = "/settings/profile";
    });
  }
</script>

{% endblock %}
